<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        {{!-- <title>Survey</title> --}}

        <link rel="stylesheet" href="/style.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"> </script>
        
    </head>
    <body>
        {{#if isAuthenticated}}
        <!-- Qualtrics-style layout for authenticated users -->
        <div class="qualtrics-layout">
            <!-- Top Header Bar -->
            <header class="qualtrics-header">
                <div class="header-left">
                    <h1 class="header-logo">Interactive Survey Tools</h1>
                </div>
                <div class="header-right">
                    <a href="/profile" class="header-link" title="Profile">Profile</a>
                    <form action="/users/logout" method="POST" style="display: inline;" id="logoutForm">
                        <button class="header-link-btn" type="button" onclick="showLogoutConfirm()">Logout</button>
                    </form>
                </div>
            </header>

            <!-- Sidebar Navigation -->
            <aside class="qualtrics-sidebar">
                <nav class="sidebar-nav">
                    <a href="/" class="sidebar-item {{#if (eq activePage 'home')}}sidebar-item-active{{/if}}">
                        <span class="sidebar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                        </span>
                        <span class="sidebar-text">Home</span>
                    </a>
                    <a href="/existing-visualizations" class="sidebar-item {{#if (eq activePage 'visualizations')}}sidebar-item-active{{/if}}">
                        <span class="sidebar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        </span>
                        <span class="sidebar-text">Visualizations</span>
                    </a>
                    <a href="/existing-survey-designs" class="sidebar-item {{#if (eq activePage 'surveys')}}sidebar-item-active{{/if}}">
                        <span class="sidebar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        </span>
                        <span class="sidebar-text">Survey Designs</span>
                    </a>
                    <a href="/existing-published-surveys" class="sidebar-item {{#if (eq activePage 'published')}}sidebar-item-active{{/if}}">
                        <span class="sidebar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                        </span>
                        <span class="sidebar-text">Published Surveys</span>
                    </a>
                    <div class="sidebar-divider"></div>
                    <a href="/faq" class="sidebar-item {{#if (eq activePage 'faq')}}sidebar-item-active{{/if}}">
                        <span class="sidebar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        </span>
                        <span class="sidebar-text">FAQ</span>
                    </a>
                    <a href="/about" class="sidebar-item {{#if (eq activePage 'about')}}sidebar-item-active{{/if}}">
                        <span class="sidebar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                        </span>
                        <span class="sidebar-text">About Us</span>
                    </a>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="qualtrics-main">
                {{#if breadcrumbs}}
                <!-- Breadcrumb Navigation -->
                <nav class="breadcrumb-nav" aria-label="Breadcrumb">
                    {{#each breadcrumbs}}
                        {{#if @last}}
                            <span class="breadcrumb-current">{{this.label}}</span>
                        {{else}}
                            <a href="{{this.url}}" class="breadcrumb-link">{{this.label}}</a>
                            <span class="breadcrumb-separator">/</span>
                        {{/if}}
                    {{/each}}
                </nav>
                {{/if}}
                <div class="content-container">
                    {{{body}}}
                </div>
            </main>
        </div>
        {{else}}
        <!-- Simple layout for unauthenticated users -->
        <div class="container" style="max-width: 48rem;">
            {{{body}}}
        </div>
        {{/if}}

        {{#if isAuthenticated}}
        <!-- Logout Confirmation Modal -->
        <div id="logoutModal" class="logout-modal" style="display: none;">
            <div class="logout-modal-content">
                <h3>Confirm Logout</h3>
                <p>Are you sure you want to log out?</p>
                <div class="logout-modal-buttons">
                    <button type="button" class="logout-btn-cancel" onclick="hideLogoutConfirm()">Cancel</button>
                    <button type="button" class="logout-btn-confirm" onclick="confirmLogout()">Logout</button>
                </div>
            </div>
        </div>

        <script>
        function showLogoutConfirm() {
            document.getElementById('logoutModal').style.display = 'flex';
        }

        function hideLogoutConfirm() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function confirmLogout() {
            document.getElementById('logoutForm').submit();
        }

        // Close modal when clicking outside
        document.getElementById('logoutModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideLogoutConfirm();
            }
        });
        </script>
        {{/if}}

        <!-- Tooltip System -->
        <script>
        // Tooltip data mapping
        const tooltipData = {
            '7': 'A survey starts with a page presenting its title and introduction text. Then, it has a page for each question which a participant must navigate through one-by-one. After the last question, the conclusion text is presented.',
            '8': 'The title of the survey is what the participant sees when they take it. The name of the survey is only seen on the designer account.',
            '9': 'On the left side of the page will be the attached visualization (if there is one). On the right side will be the question, the response prompt/field, and a comment box (if included).',
            '10': 'The question type is the format in which a participant responds to the question.',
            '11': 'A survey comment is an optional response section for a user to add any comments they may have about a specific survey question.',
            '12': 'A participant must leave a response in order to continue, and the response must match the min/max parameters (if they exist). To disable a min/max, set it to 0.',
            '13': 'A visualization from your account may be selected and attached to the given question. Changes to the visualization in the question edit page will be specific to that question.',
            '14': 'The survey will be made available for completion in the specified time frame. The published survey will follow the state of the design at the time of publication, and it is accessible through a shareable link.',
            '15': 'A survey may only be completed between its opening time and its closing time.',
            '16': 'A survey\'s status can be "pending," "in-progress," or "closed." "Pending" means the opening date/time is still in the future and the survey has not opened for completion yet. "In-progress" means it is currently open. "Closed" means the closing date/time has passed and the survey is no longer open for completion.'
        };

        // Initialize tooltips when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Create tooltip container if it doesn't exist
            if (!document.getElementById('tooltipContainer')) {
                const tooltipContainer = document.createElement('div');
                tooltipContainer.id = 'tooltipContainer';
                tooltipContainer.className = 'tooltip-popup';
                document.body.appendChild(tooltipContainer);
            }

            const tooltip = document.getElementById('tooltipContainer');

            // Add event listeners to all help buttons
            document.querySelectorAll('.help-tooltip').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const faqId = this.getAttribute('data-faq-id');
                    const content = tooltipData[faqId];

                    if (content) {
                        // Set tooltip content
                        tooltip.innerHTML = `
                            <div class="tooltip-content">
                                <button class="tooltip-close" onclick="hideTooltip()">&times;</button>
                                <p>${content}</p>
                            </div>
                        `;

                        // Position tooltip near the button
                        const rect = this.getBoundingClientRect();
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

                        tooltip.style.top = (rect.bottom + scrollTop + 8) + 'px';
                        tooltip.style.left = (rect.left + scrollLeft) + 'px';
                        tooltip.classList.add('active');
                    }
                });
            });

            // Close tooltip when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.help-tooltip') && !e.target.closest('.tooltip-popup')) {
                    hideTooltip();
                }
            });
        });

        function hideTooltip() {
            const tooltip = document.getElementById('tooltipContainer');
            if (tooltip) {
                tooltip.classList.remove('active');
            }
        }
        </script>
    </body>
</html>