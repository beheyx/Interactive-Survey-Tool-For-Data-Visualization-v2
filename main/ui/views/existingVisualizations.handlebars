<!-- Title bar -->
<header class="app-header" role="banner">
  <h1>Interactive Survey Tools for Data Visualizations</h1>
</header>

<!-- Top nav -->
<nav class="top-nav" aria-label="Primary">
  <div class="nav-left">
  </div>
  <ul class="nav-actions">
    <li><a class="pill" href="/">Home</a></li>
    <li><a class="pill" href="/faq.html" target="_blank" rel="noopener">FAQ</a></li>
    <li><a class="pill" href="/about">About Us</a></li>
  </ul>
  <div class="nav-right">
    <form action="/users/logout" method="POST">
      <button class="pill" type="submit">Logout</button>
    </form>
  </div>
</nav>

<!-- Page content -->
<main class="existing-page">
  <div class="page-header">
    <h2>Your Visualizations</h2>
    <a class="action-button" href="#visualizationsPopup">+ New Visualization</a>
  </div>

  <div class="table-container">
    {{#if visualizations}}
      <table class="data-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{#each visualizations}}
            <tr>
              <td>
                <a href="/visualizations/{{id}}" class="table-link">{{name}}</a>
              </td>
              <td>{{createdAt}}</td>
              <td class="actions-cell">
                <a class="table-btn rename-btn" href="#visualizationsRenamePopup{{id}}">Rename</a>
                <form action="/visualizations/{{id}}/DELETE" method="POST" style="display: inline;">
                  <button class="table-btn delete-btn" type="submit">Delete</button>
                </form>
              </td>
            </tr>

            <!-- Rename popup for each item -->
            <div class="popup rename-popup" id="visualizationsRenamePopup{{id}}">
              <div class="popup-content">
                <h2>Rename "{{name}}"</h2>
                <form action="/visualizations/{{id}}/PATCH" method="POST">
                  <input type="text" name="name" placeholder="new name" class="rename-input">
                  <p class="rename-error" hidden></p>
                  <button class="popup-rename-button">Rename</button>
                </form>
                <button type="button" class="popup-cancel-button" onclick="window.location.hash=''">Cancel</button>
              </div>
            </div>
          {{/each}}
        </tbody>
      </table>
    {{else}}
      <div class="empty-state">
        <p>No visualizations yet. Create your first one!</p>
        <a class="action-button" href="#visualizationsPopup">+ New Visualization</a>
      </div>
    {{/if}}

    {{#if visError}}
      <p class="error-message">{{visError}}</p>
    {{/if}}
  </div>
</main>

<!-- New Visualization Popup -->
<div class="popup" id="visualizationsPopup">
  <div class="popup-content">
    <h2>Create a New Visualization</h2>
    <form action="/visualizations" method="POST">
      <input type="text" name="name" placeholder="visualization name" />
      <button class="popup-create-button" id="create-visualization-button">Create</button>
    </form>
    <button type="button" class="popup-cancel-button" onclick="window.location.hash=''">Cancel</button>
  </div>
</div>
